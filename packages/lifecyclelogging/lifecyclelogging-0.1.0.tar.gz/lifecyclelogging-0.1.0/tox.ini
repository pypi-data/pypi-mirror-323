# tox.ini
[tox]
envlist = py38, py39, py310, py311, py312, lint, type_check, docs

[gh-actions]
python =
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312

[testenv]
deps =
    .[test]
    coverage[toml]
commands =
    pytest --cov=lifecyclelogging --cov-report=term-missing --cov-report=xml --cov-report=html {posargs}

[testenv:lint]
description = Run linting to check code quality
deps = .[dev]
commands = ruff check .

[testenv:format]
description = Format code and sort imports
deps = .[dev]
commands = ruff check --fix .

[testenv:type_check]
description = Run type checking
deps = .[dev]
commands =
    mypy src/lifecyclelogging
    mypy tests

[testenv:docs]
description = Build and check documentation
deps = .[docs]
commands =
    # Build the documentation with warnings treated as errors
    sphinx-build -W docs docs/_build/html
    # Run a single linkcheck build to avoid duplicate runs
    sphinx-build -b linkcheck docs docs/_build/linkcheck

[testenv:coverage_report]
description = Generate coverage report
skip_install = true
deps = coverage[toml]
commands =
    coverage combine --append
    coverage report
    coverage html
    coverage xml