{% load i18n datashow_tags %}
<div id="datashow-table-{{ table.id }}">
    {% if filter_form.has_filter %}
        <div class="row">
            <div class="col-md-8 justify-content-end">
                <form method="get"
                      action="."
                      hx-boost="true"
                      hx-target="#datashow-table-{{ table.id }}"
                      hx-swap="show:none"
                      class="mb-3">
                    {% include "datashow/_filterform.html" with form=filter_form %}
                    <div class="d-flex justify-content-end">
                        {% if filter_form.is_filtered %}
                            <a href="." class="btn btn-secondary me-3">{% translate "Reset" %}</a>
                        {% endif %}
                        <button type="submit" class="btn btn-primary">{% translate "Search" %}</button>
                    </div>
                </form>
            </div>
        </div>
    {% endif %}
    {% if facets %}
        <div class="row">
            {% for facet in facets %}
                <div class="col-md-2 col-3">
                    <h5>{{ facet.column.label }}</h5>
                    <ul class="list-unstyled datashow-facetlist">
                        {% for key, count, active in facet.keys %}
                            <li>
                                {% if active %}
                                    {{ key }}
                                    <a href="?{% querystring facet.column.name %}"
                                       hx-boost="true"
                                       hx-target="#datashow-table-{{ table.id }}"
                                       hx-swap="show:none">
                                        <span class="visually-hidden">{% translate "remove filter" %}</span>
                                        <span aria-hidden="true">&times;</span>
                                    </a>
                                {% else %}
                                    <a href="?{% querystring facet.column.name key %}"
                                       hx-boost="true"
                                       hx-target="#datashow-table-{{ table.id }}"
                                       hx-swap="show:none">{{ key }}</a>
                                {% endif %}
                                <small class="float-end">{{ count }}</small>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    <div class="table-responsive">
        <table id="datashow-table-{{ table.id }}"
               class="table table-sm"
               data-rowcount="{{ table.row_count }}">
            <thead>
                <tr hx-boost="true" hx-target="#datashow-table-{{ table.id }}">
                    {% for column, css in columns %}
                        <th class="text-nowrap {{ css }}">
                            <span title="{{ column.label }}">{{ column.label|truncatechars:20 }}</span>
                            {% if column.sortable %}
                                {% spaceless %}
                                    {% querystring "sort" column.name as asc_sort %}
                                    {% if asc_sort %}<a href="?{{ asc_sort }}">{% endif %}
                                        <span aria-hidden="true">↑</span>
                                        <span class="visually-hidden">{% translate "sort ascending" %}</span>
                                        {% if asc_sort %}</a>{% endif %}
                                    {% querystring "sort" "-"|add:column.name as desc_sort %}
                                    {% if desc_sort %}<a href="?{{ desc_sort }}">{% endif %}
                                        <span aria-hidden="true">↓</span>
                                        <span class="visually-hidden">{% translate "sort descending" %}</span>
                                        {% if desc_sort %}</a>{% endif %}
                                {% endspaceless %}
                            {% endif %}
                        </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody class="table-group-divider">
                {% for row in object_list %}
                    <tr>
                        {% for val, css, rendered in row %}<td data-val="{{ val }}" class="{{ css }}">{{ rendered }}</td>{% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p>
        {% if filter_form.is_filtered %}
            {% blocktrans with total_count=table.row_count count=paginator.count %}
            Showing {{ count }} of {{ total_count }} rows.
        {% endblocktrans %}
        {% else %}
            {% blocktrans with total_count=table.row_count %}
            Showing {{ total_count }} rows.
            {% endblocktrans %}
        {% endif %}
    </p>
    <div class="row">
        <div class="col-md-6">
            {% if paginator.num_pages > 1 %}
                <div hx-boost="true"
                     hx-swap="show:none"
                     hx-target="#datashow-table-{{ table.id }}">{% include "datashow/pagination.html" %}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <div class="d-flex justify-content-end">
                <a href="{% url "datashow:dataset_table_export" slug=dataset.slug table_slug=table.slug %}?{% querystring %}"
                   class="btn btn-sm btn-secondary">{% translate "Export CSV" %}</a>
            </div>
        </div>
    </div>
</div>
