import{u as T,Q as K}from"./use-meta-DOYUf45L.js";import{u as I}from"./use-quasar-rqy1CZtR.js";import{u as M,Q as g}from"./token-BRgTGkAl.js";import{a as U,r as u,o as S,w,a5 as b,a6 as $,a9 as n,aa as l,J as h,ac as f,a8 as i,ab as m,ag as d,a7 as y,ay as R,aL as W,ak as F,at as E,e as H,ae as J}from"./index-DICPTgNa.js";import{Q as X}from"./QBtnGroup-BPjYUmQ9.js";import{a as Y}from"./rtl-Cq6Y33Hr.js";import{Q as Z,a as ee,b as ae}from"./QTable-CCY7eiso.js";import{get as te,post as V}from"./axios-BkL3qjuP.js";import{u as ne}from"./vue-i18n.runtime-BTnF4KD_.js";import"./QItemLabel-DKKcZbkY.js";const oe={class:"q-pa-md"},se={key:0},le={key:1},ie={__name:"UserList",setup(q){const{t:e}=ne(),o=I(),p=M(),x=U(()=>[{name:"username",required:!0,label:e("username"),align:"left",field:"username"},{name:"email",align:"center",label:e("email"),field:"email"},{name:"date_joined",label:e("date_joined"),field:"date_joined"},{name:"last_login",label:e("last_login"),field:"last_login"},{name:"updated_time",label:e("updated_time"),field:"updated_time"},{name:"action",label:e("action"),align:"right"}]),k=U(()=>p.token),r=u([]),C=u([]),P=u(""),Q=u(0),_=u({page:1,rowsPerPage:1,rowsNumber:1}),O=U(()=>k.value!==""?Math.ceil(Q.value/_.value.rowsPerPage):0),A=u(o.screen.height*.73+"px"),G=u(o.screen.width*.825+"px"),z=u(o.dark.isActive?"#121212":"#ffffff");function v(s){let t={};s?t=s:t.pagination=_.value,p.userPermissionGet("Get User List")&&(te({url:"core/user/",params:{search:P.value,page:t.pagination.page,max_page:t.pagination.rowsPerPage}}).then(a=>{r.value=a.results,Q.value=a.count,C.value=a.permission}).catch(a=>(o.loading.hide(),Promise.reject(a))),_.value=t.pagination)}function j(s){console.log("pageChange",s)}function D(s){o.dialog({dark:o.dark.isActive,title:e("changepassword"),message:e("changePWD"),prompt:{model:"",isValid:t=>t.length>2,type:"text"},cancel:!0}).onOk(t=>{V("core/user/changepwd/",{id:s,pwd:t}).then(()=>{o.notify({type:"success",message:e("sucesschangepwd")})}).catch(a=>{o.notify({type:"error",message:a}),o.loading.hide()})})}function L(s){o.dialog({title:"Options",message:"Choose your options:",options:{type:"checkbox",model:Object.keys(r.value[s].permission),inline:!0,items:C.value},cancel:!0}).onOk(t=>{console.log(">>>> OK, received",t)})}function B(s){V("core/user/lock/",{id:r.value[s].id}).then(()=>{o.notify({type:"success",message:e("success")}),r.value[s].is_active=!r.value[s].is_active}).catch(t=>{o.notify({type:"error",message:t}),o.loading.hide()})}function N(s){o.dialog({dark:o.dark.isActive,title:e("deleteuser"),message:e("confirmnotice"),cancel:!0}).onOk(()=>{V("core/user/delete/",{id:r.value[s].id}).then(()=>{o.notify({type:"success",message:e("success")}),r.value.splice(s,1)}).catch(t=>{o.notify({type:"error",message:t}),o.loading.hide()})})}return S(()=>{v()}),w(()=>o.dark.isActive,s=>{z.value=s?"#121212":"#ffffff"}),w(()=>_.value,s=>{console.log("watch",s.sortBy)}),w(()=>k.value,s=>{s===""?(r.value=[],Q.value=0):v()}),(s,t)=>(b(),$("div",oe,[n(ae,{class:E(i(o).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:r.value,columns:x.value,"row-key":"name",pagination:_.value,separator:"cell","no-data-label":i(e)("nodata"),"rows-per-page-label":i(e)("per_page"),"rows-per-page-options":[1,10,30,50,200,0],"table-style":{height:A.value,width:G.value},"card-style":{backgroundColor:z.value},onRequest:v},{top:l(a=>[n(X,{flat:""},{default:l(()=>[h(n(f,{label:i(e)("refresh"),icon:"refresh",onClick:t[0]||(t[0]=c=>v())},{default:l(()=>[n(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(d(i(e)("refreshdata")),1)]),_:1})]),_:1},8,["label"]),[[y,i(p).userPermissionGet("Get User List")]]),h(n(f,{label:i(e)("new"),icon:"add"},{default:l(()=>[n(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(d(i(e)("newUser")),1)]),_:1})]),_:1},8,["label"]),[[y,i(p).userPermissionGet("Create One User")]])]),_:1}),n(Y),n(R,{dense:"",debounce:"300",color:"primary",modelValue:P.value,"onUpdate:modelValue":t[1]||(t[1]=c=>P.value=c),onInput:t[2]||(t[2]=c=>v()),onKeyup:t[3]||(t[3]=W(c=>v(),["enter"]))},{append:l(()=>[n(F,{name:"search"})]),_:1},8,["modelValue"]),n(f,{flat:"",round:"",dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":l(a=>[n(Z,{props:a},{default:l(()=>[a.col.name==="action"?(b(),$("div",se,[n(f,{round:"",flat:"",icon:"published_with_changes",onClick:c=>D(a.row.id)},{default:l(()=>[n(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(d(i(e)("changepassword")),1)]),_:1})]),_:2},1032,["onClick"]),n(f,{round:"",flat:"",icon:"admin_panel_settings",onClick:c=>L(a.rowIndex)},{default:l(()=>[n(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(d(i(e)("permission")),1)]),_:1})]),_:2},1032,["onClick"]),h(n(f,{round:"",flat:"",icon:"lock_person",onClick:c=>B(a.rowIndex)},{default:l(()=>[n(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(d(i(e)("isnotactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,!a.row.is_active]]),h(n(f,{round:"",flat:"",icon:"lock_open",onClick:c=>B(a.rowIndex)},{default:l(()=>[n(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(d(i(e)("isactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,a.row.is_active]]),n(f,{round:"",flat:"",icon:"delete_sweep",onClick:c=>N(a.rowIndex)},{default:l(()=>[n(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(d(i(e)("deleteuser")),1)]),_:1})]),_:2},1032,["onClick"])])):(b(),$("div",le,d(a.value),1))]),_:2},1032,["props"])]),pagination:l(a=>[m(d(i(e)("total"))+d(O.value)+" "+d(i(e)("page"))+" ",1),n(ee,{modelValue:a.pagination.page,"onUpdate:modelValue":[c=>a.pagination.page=c,c=>j(a)],max:a.pagesNumber,input:"","input-class":"text-orange-10"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},ke={__name:"UserReader",setup(q){const e=I(),o=u(!1),p=u(""),x=u(""),k=u("");return T(()=>({title:p.value,meta:{description:{name:"description",content:x.value},keywords:{name:"keywords",content:k.value}}})),S(()=>{}),H(()=>{}),w(()=>e.dark.isActive,r=>{o.value=r}),(r,C)=>(b(),J(K,{class:"flex flex-top"},{default:l(()=>[n(ie)]),_:1}))}};export{ke as default};
