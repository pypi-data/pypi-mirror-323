Metadata-Version: 2.1
Name: nonebot-plugin-fishspeech-tts
Version: 0.3.9
Summary: å°æ ·æœ¬TTS,é€šè¿‡è°ƒç”¨åœ¨çº¿æˆ–æœ¬åœ°apiå‘é€TTSè¯­éŸ³
Author-Email: Cvandia <106718176+Cvandia@users.noreply.github.com>
License: MIT
Requires-Python: <4.0,>=3.10
Requires-Dist: ormsgpack<2.0.0,>=1.7.0
Requires-Dist: httpx>=0.27.0
Requires-Dist: nonebot2>=2.2.0
Requires-Dist: nonebot-plugin-alconna>=0.46.4
Description-Content-Type: text/markdown

<div align="center">

# nonebot-plugin-fishspeech-tts

<a href="https://v2.nonebot.dev/store">
<img src="https://count.getloli.com/get/@nonebot-plugin-fishspeech-tts?theme=asoul"></a>

_â­åŸºäºNonebot2çš„è°ƒç”¨åœ¨çº¿[fish-audio](https://fish-audio.cn/zh-CN/)æˆ–ç¦»çº¿[fish-speech](https://github.com/fishaudio/fish-speech) apiâ­_
_â­æ–‡æœ¬ç”Ÿæˆè¯­éŸ³`tts`æ’ä»¶â­_

<a href="https://www.python.org/downloads/release/python-390/">
    <img src="https://img.shields.io/badge/python-3.10+-blue"></a>
<a href="https://qm.qq.com/q/SL6m4KdFe4">
    <img src="https://img.shields.io/badge/QQ-1141538825-yellow"></a>
<a href="https://github.com/Cvandia/nonebot-plugin-game-torrent/blob/main/LICENCE">
    <img src="https://img.shields.io/badge/license-MIT-blue"></a>
<a href="https://v2.nonebot.dev/">
    <img src="https://img.shields.io/badge/Nonebot2-2.2.0+-red"></a>
<a href="https://github.com/Cvandia/nonebot-plugin-fishspeech-tts/actions/workflows/python-app.yml">
    <img src="https://github.com/Cvandia/nonebot-plugin-fishspeech-tts/actions/workflows/python-app.yml/badge.svg?branch=master"></a>

**ä¸­æ–‡ç®€ä½“** | [**English**](./docs/README_EN.md)

</div>

---

## â­ ä»‹ç»

**ä»…éœ€ä¸€æ¡5ç§’è¯­éŸ³ç´ æï¼Œå°±å¯~~å®Œç¾~~ä¼˜ç§€å…‹éš†ç´ ææœ¬éŸ³å‘ï¼**
åªéœ€è¦å‡†å¤‡å¥½ä½ æƒ³å…‹éš†çš„è§’è‰²è¯­éŸ³ï¼Œå¹¶å¯¹å…¶è¯­éŸ³è¿›è¡Œæ–‡ä»¶åçš„æ ‡æ³¨(è§ä¸‹æ–‡)ï¼Œå°±å¯ä»¥å¿«é€Ÿç”Ÿæˆè¯­éŸ³ã€‚

> æˆ–è€…ä½¿ç”¨å®˜æ–¹åœ¨çº¿api -> [fish-audio](https://fish-audio.cn/zh-CN/)å³å¯äº«å—å¿«é€Ÿäº‘ç«¯çš„è¯­éŸ³ç”Ÿæˆã€‚

## ğŸ“œ å…è´£å£°æ˜

> [!CAUTION]
> æœ¬æ’ä»¶ä»…ä¾›**å­¦ä¹ **å’Œ**ç ”ç©¶**ä½¿ç”¨ï¼Œä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨æ’ä»¶çš„é£é™©ã€‚ä½œè€…ä¸å¯¹æ’ä»¶çš„ä½¿ç”¨é€ æˆçš„ä»»ä½•æŸå¤±æˆ–é—®é¢˜è´Ÿè´£ã€‚è¯·åˆç†ä½¿ç”¨æ’ä»¶ï¼Œ**éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚**
ä½¿ç”¨**æœ¬æ’ä»¶å³è¡¨ç¤ºæ‚¨å·²é˜…è¯»å¹¶åŒæ„éµå®ˆä»¥ä¸Šå…è´£å£°æ˜**ã€‚å¦‚æœæ‚¨ä¸åŒæ„æˆ–æ— æ³•éµå®ˆä»¥ä¸Šå£°æ˜ï¼Œè¯·ä¸è¦ä½¿ç”¨æœ¬æ’ä»¶ã€‚

---

## ğŸ’¿ å®‰è£…

<details>
<summary>å®‰è£…</summary>

`pipx` å®‰è£…

```bash
pipx install nonebot-plugin-fishspeech-tts -U
```
> [!note] åœ¨nonebotçš„pyproject.tomlä¸­çš„plugins = ["xxx"]æ·»åŠ æ­¤æ’ä»¶

`nb-cli`å®‰è£…
```bash
nb plugin install nonebot-plugin-fishspeech-tts -U
```

`git clone`å®‰è£…(ä¸æ¨è)

- å‘½ä»¤çª—å£`cmd`ä¸‹è¿è¡Œ
```bash
git clone https://github.com/Cvandia/nonebot-plugin-fishspeech-tts
```
- åœ¨çª—å£è¿è¡Œå¤„
å°†æ–‡ä»¶å¤¹`nonebot-plugin-fishspeech-tts`å¤åˆ¶åˆ°botæ ¹ç›®å½•ä¸‹çš„`src/plugins`(æˆ–åˆ›å»ºbotæ—¶çš„å…¶ä»–åç§°`xxx/plugins`)


 </details>

 <details>
 <summary>æ³¨æ„</summary>

 æ¨èé•œåƒç«™ä¸‹è½½

 æ¸…åæº```https://pypi.tuna.tsinghua.edu.cn/simple```

 é˜¿é‡Œæº```https://mirrors.aliyun.com/pypi/simple/```

</details>

## âš™ï¸ é…ç½®

**åœ¨.envä¸­æ·»åŠ ä»¥ä¸‹é…ç½®**

|      åŸºç¡€é…ç½®      |  ç±»å‹   | å¿…å¡«é¡¹ |      é»˜è®¤å€¼       |                            è¯´æ˜                             |
| :----------------: | :-----: | :----: | :---------------: | :---------------------------------------------------------: |
|   tts_is_online    |  bool   |   æ˜¯   |       True        |                       æ˜¯å¦ä½¿ç”¨äº‘ç«¯api                       |
|  tts_chunk_length  | literal |   å¦   |     "normal"      | è¯·æ±‚æ—¶éŸ³é¢‘åˆ†ç‰‡é•¿åº¦ï¼Œé»˜è®¤ä¸ºnormalï¼Œå¯é€‰ï¼šshort, normal, long |
| tts_max_new_tokens |   int   |   å¦   |        800        |          æœ€å¤§éŸ³é¢‘é•¿åº¦ï¼Œé»˜è®¤ä¸º800,è®¾ç½®ä¸º0åˆ™ä¸ºä¸é™åˆ¶          |
|   tts_audio_path   |   str   |   å¦   | "./data/å‚è€ƒéŸ³é¢‘" |            è¯­éŸ³ç´ æè·¯å¾„ï¼Œé»˜è®¤ä¸º"./data/å‚è€ƒéŸ³é¢‘"            |
|     tts_prefix     |   str   |   å¦   |       None        |                    è§¦å‘å‰ç¼€ï¼Œé»˜è®¤ä¸ºNone                     |

**æ³¨ï¼šå‚è€ƒéŸ³é¢‘çš„æ–‡ä»¶åæ ¼å¼ä¸ºï¼šï¼»è§’è‰²åï¼½éŸ³é¢‘å¯¹åº”çš„æ–‡å­—æ ‡ç­¾.[éŸ³é¢‘åç¼€å]**

ç‚¹å‡»[è¿™é‡Œ](https://github.com/Cvandia/nonebot-plugin-fishspeech-tts/releases)å¯é€‰æ‹©ä¸‹è½½æ¨èå‚è€ƒéŸ³é¢‘`reference_audio.zip`ï¼Œè§£å‹å¹¶æŠŠéŸ³é¢‘å¹¶æ”¾å…¥botæ–‡ä»¶ç›®å½•çš„`data/å‚è€ƒéŸ³é¢‘`ä¸‹å³å¯

**! æ”¯æŒåŒä¸€è§’è‰²çš„ä¸åŒè¯­éŸ³ !**

**éŸ³é¢‘åç¼€ç›®å‰æ”¯æŒæœ‰è¯¦è§[files.py](./nonebot_plugin_fishspeech_tts/files.py)ä¸­çš„`AUDIO_FILE_SUFFIX`**
___

å¦‚æœä½ æƒ³ä½¿ç”¨å®˜æ–¹çš„apiï¼Œè¯·å°†é…ç½®é¡¹`tts_is_online`è®¾ç½®ä¸º`True`å¹¶é…ç½®ä»¥ä¸‹

|        é…ç½®é¡¹        | ç±»å‹  | å¿…å¡«é¡¹ |           é»˜è®¤å€¼            |                                                                                     è¯´æ˜                                                                                     |
| :------------------: | :---: | :----: | :-------------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|    online_api_url    |  str  |   å¦   | "https://api.fish-audio.cn" |                                                                                 å®˜ç½‘apiåœ°å€ï¼Œå¯é€‰https://api.fish.audio(è¢«å¢™)æˆ–è€…é»˜è®¤å€¼                                                                                  |
| online_authorization |  str  |   æ˜¯   |           "xxxxx"           |                                                    å®˜ç½‘apié‰´æƒç§˜é’¥ï¼Œè¯¦è§[é“¾æ¥](https://fish.audio/zh-CN/go-api/api-keys/)                                                    |
|  online_model_first  | bool  |   å¦   |            True             | å¦‚æœä½ æƒ³è°ƒç”¨å®˜æ–¹æ¨¡å‹ï¼Œé€šè¿‡è‡ªå·±çš„å‚è€ƒéŸ³é¢‘ï¼Œå®šåˆ¶è§’è‰²éŸ³è‰²ï¼Œå°†æ­¤é¡¹è®¾ä¸º`False`ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ²¡æœ‰å‡†å¤‡å‚è€ƒéŸ³é¢‘ï¼Œä¹Ÿä¼šè°ƒç”¨å®˜ç½‘å·²ç»æœ‰çš„éŸ³è‰²ï¼Œå…·ä½“è¯¦è§[é“¾æ¥](https://fish.audio/zh-CN/) |
|   online_api_proxy   |  str  |   å¦   |            None             |                                                                     ä»£ç†åœ°å€ï¼Œå¦‚ï¼šhttp://127.0.0.1:7890                                                                      |

---

å¦‚æœä½ æƒ³ä½¿ç”¨[è‡ªæ­](#ç¦»çº¿æ­å»ºfish-speech)æˆ–è€…å…¶ä»–çš„[fish-speech](https://github.com/fishaudio/fish-speech)é¡¹ç›®çš„api,è¯·å°†é…ç½®é¡¹`tts_is_online`è®¾ç½®ä¸º`Fasle`å¹¶é…ç½®ä»¥ä¸‹

|     é…ç½®é¡¹      | ç±»å‹  | å¿…å¡«é¡¹ |         é»˜è®¤å€¼          |           è¯´æ˜           |
| :-------------: | :---: | :----: | :---------------------: | :----------------------: |
| offline_api_url |  str  |   æ˜¯   | "http://127.0.0.1:8080" | ä½ çš„`fish-speech`apiåœ°å€ |

## â­ ä½¿ç”¨

> [!note]
> è¯·æ³¨æ„ä½ çš„ `COMMAND_START` ä»¥åŠä¸Šè¿°é…ç½®é¡¹ã€‚

### æŒ‡ä»¤ï¼š

|   æŒ‡ä»¤   |  éœ€è¦@   | èŒƒå›´  |       è¯´æ˜       | æƒé™  |
| :------: | :------: | :---: | :--------------: | :---: |
| xxxè¯´xxx | æ ¹æ®é…ç½® |  all  |   ttsè¯­éŸ³ç”Ÿæˆ    |  all  |
| è¯­éŸ³åˆ—è¡¨ |    æ˜¯    |  all  | è·å–æ‰€æœ‰è§’è‰²åˆ—è¡¨ |  all  |
| è¯­éŸ³ä½™é¢ |    æ˜¯    |  all  |   æŸ¥è¯¢apiä½™é¢    |  all  |

## ğŸŒ™ Todo
 - [x] æ·»åŠ æ›´å¤šé…ç½®é¡¹
 - [ ] æš‚æ— è®¡åˆ’

<center>å–œæ¬¢è®°å¾—ç‚¹ä¸ªstarâ­</center>

## ğŸ’ ç‰¹åˆ«é¸£è°¢

- [x] [nonebot2](https://github.com/nonebot/nonebot2): æœ¬é¡¹ç›®çš„åŸºç¡€ï¼Œéå¸¸å¥½ç”¨çš„èŠå¤©æœºå™¨äººæ¡†æ¶ã€‚
- [x] [fish-speech](https://github.com/fishaudio/fish-speech):é›¶æ ·æœ¬ & å°æ ·æœ¬ TTSï¼šè¾“å…¥ 10 åˆ° 30 ç§’çš„å£°éŸ³æ ·æœ¬å³å¯ç”Ÿæˆé«˜è´¨é‡çš„ TTS è¾“å‡º


## â­ é¢å¤–å¸®åŠ©

### windowsç¦»çº¿æ­å»ºç®€ç•¥æ•™ç¨‹

**ä½¿ç”¨å‰**
- [ ] [CUDA toolkit](https://developer.nvidia.com/cuda-toolkit) ä½¿ç”¨å‰ç¡®ä¿å®‰è£…æ­£ç¡®ç‰ˆæœ¬çš„CUDA

**å‡†å¤‡`fish-speech`**
- 1.å°†`fish-speech` ä»“åº“ [`release`](https://github.com/fishaudio/fish-speech/releases) çš„ä»£ç (`Source code
(zip)`)ä¸‹è½½åˆ°æœ¬åœ°
- 2.è§£å‹åˆ°æœ¬åœ°
- 3.æ‰“å¼€`fish-speech`æ ¹ç›®å½•
- 4.è¿è¡Œ`install_env.bat`å®‰è£…è™šæ‹Ÿç¯å¢ƒä»¥åŠæ‰€éœ€ä¾èµ–
- 5.è¿è¡Œ`start.bat`åˆæ¬¡å¯åŠ¨
- 6.ä¿®æ”¹`API_FLAGS.txt`åå†æ¬¡å¯åŠ¨å³å¯

**å¯åŠ¨APIæœåŠ¡**

- 1.ä¿®æ”¹`API_FLAGS.txt`å¤§è‡´ä¸ºä»¥ä¸‹å†…å®¹ï¼Œå³å–æ¶ˆ`api`å‰é¢çš„`#`å·
```bash
# --infer
--api
--listen 0.0.0.0:8080 \ #ç›‘å¬æ¥å£
...
```
**åœ¨`API_FLAGS.txt`é‡Œå¯æ·»åŠ çš„é¢å¤–å‚æ•°**
- 1.`--complie` ->æ˜¯å¦å¯åŠ¨ç¼–è¯‘åçš„æ¨¡å‹ (æ›´å¿«çš„ç”Ÿæˆttsï¼Œä½†å¯åŠ¨è¾ƒæ…¢)
- 2.`--workers æ•°å­—` ->å¯åŠ¨`æ•°å­—`ä¸ªå¤šåç¨‹ (è¯·åŠ¡å¿…è®¾ç½®ï¼Œå› ä¸ºé»˜è®¤ä¸€ä¸ªå®¹æ˜“é˜»å¡)
- 3.`--device cpu` ->ä½¿ç”¨cpuç”Ÿæˆtts (å¦‚æœä½¿ç”¨gpuï¼Œè¯·å¿½ç•¥)
- 4.`--half` ->ä½¿ç”¨åŠç²¾åº¦ç”Ÿæˆtts
- 5.`--max-text-length` ->è¾“å…¥æ–‡æœ¬æœ€å¤§é•¿åº¦

### linuxç¦»çº¿æ­å»ºfish-speech
- æ›´å¤šå‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://speech.fish.audio/zh)
