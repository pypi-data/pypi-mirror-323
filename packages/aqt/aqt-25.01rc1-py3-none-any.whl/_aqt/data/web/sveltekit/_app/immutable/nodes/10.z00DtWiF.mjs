var Ft=Object.defineProperty;var Gt=(a,t,e)=>t in a?Ft(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var k=(a,t,e)=>Gt(a,typeof t!="symbol"?t+"":t,e);import{j as Ct,k as Vt,m as Et,n as Ut,o as zt,C as Y,p as ht,q as It,s as qt}from"../chunks/backend.B-rEzG1h.mjs";import{ay as Bt,az as kt,aA as Rt,aB as Wt,aC as Jt,aD as Kt,aE as Yt,aF as Qt,aG as Xt,aH as Zt,aI as te,aJ as ee,aK as ae,aL as le,aM as se,aN as oe,aO as re,aP as ie,aQ as ne,aR as Ot,aS as ue,aT as de,aU as ce,aV as pe,aW as me,aX as $e,aY as ve,aZ as ge,a_ as fe,a$ as he,J as Pt}from"../chunks/runtime-require.CdrmIVJi.mjs";import{w as ct,r as Tt}from"../chunks/index.yI85F2M8.mjs";import{c as et}from"../chunks/cloneDeep.BnutOe-B.mjs";import{i as dt,S as be}from"../chunks/Select.esKcVuQn.mjs";import{t as V,a as p,b as M,e as yt}from"../chunks/disclose-version.CLyesH2z.mjs";import{i as B}from"../chunks/legacy.C9ld2zwP.mjs";import{p as W,l as ye,a as _e,a2 as R,t as D,g as $,b as J,n as U,K as P,M as T,m as rt,s as it,L as St,B as N,aD as S,J as at}from"../chunks/runtime.9HYTEYPq.mjs";import{p as w,a as _t}from"../chunks/props.DYb31JuL.mjs";import{R as ot}from"../chunks/Row.CSJRSN1D.mjs";import{I as ke}from"../chunks/ImportPage.myG9ar-C.mjs";import{a as Ne}from"../chunks/await.BUtSeJRC.mjs";import{e as pt,i as mt}from"../chunks/theme.CXOh7ovT.mjs";import{a as H,s as nt,q as z,b as E,p as xt,r as jt}from"../chunks/store.CPnfR7A8.mjs";import{T as Nt}from"../chunks/TitledContainer.DOvsu3Dr.mjs";import{c as Q}from"../chunks/Container.D3Od9Kte.mjs";import{C as $t}from"../chunks/Col.C_O1ytZJ.mjs";import{H as j,E as st,a as q,S as Ce,b as At,C as Ie,R as Oe}from"../chunks/EnumSelectorRow.DzLLz8k8.mjs";import{T as Pe}from"../chunks/TagEditor.C90703rE.mjs";function wt(){}function K(a){return a.notetype.case==="globalNotetype"?a.notetype.value:null}function bt(a){return a.deck.case==="deckId"?a.deck.value:null}class Te{constructor(t,e,s,l){k(this,"path");k(this,"deckNameIds");k(this,"notetypeNameIds");k(this,"defaultDelimiter");k(this,"defaultIsHtml");k(this,"defaultNotetypeId");k(this,"defaultDeckId");k(this,"metadata");k(this,"globalNotetype");k(this,"deckId");k(this,"fieldNames");k(this,"columnOptions");k(this,"lastMetadata");k(this,"lastGlobalNotetype");k(this,"lastDeckId");k(this,"fieldNamesSetter",wt);k(this,"columnOptionsSetter",wt);var r;this.path=t,this.deckNameIds=s.entries,this.notetypeNameIds=e.entries,this.lastMetadata=et(l),this.metadata=ct(l),this.metadata.subscribe(this.onMetadataChanged.bind(this));const o=K(l);this.lastGlobalNotetype=et(K(l)),this.globalNotetype=ct(et(o)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=bt(l),this.deckId=ct(bt(l)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=Tt(o===null?Promise.resolve([]):Ct({ntid:o.id}).then(i=>i.vals),i=>{this.fieldNamesSetter=i}),this.columnOptions=Tt(Mt(l),i=>{this.columnOptionsSetter=i}),this.defaultDelimiter=l.delimiter,this.defaultIsHtml=l.isHtml,this.defaultNotetypeId=((r=this.lastGlobalNotetype)==null?void 0:r.id)||null,this.defaultDeckId=this.lastDeckId}doImport(){return Vt({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var l,o,r;if(dt(t,this.lastMetadata))return;const e=this.shouldRefetchMetadata(t);e&&(t=await Et({path:this.path,delimiter:t.delimiter,notetypeId:(l=K(t))==null?void 0:l.id,deckId:(o=bt(t))!=null?o:void 0,isHtml:t.isHtml}));const s=K(t);this.globalNotetype.set(s),s!==null&&s.id!==((r=K(this.lastMetadata))==null?void 0:r.id)&&this.fieldNamesSetter(Ct({ntid:s.id}).then(i=>i.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(Mt(t)),this.lastMetadata=et(t),e&&this.metadata.set(t)}shouldRefetchMetadata(t){var e,s;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((e=K(t))==null?void 0:e.id)!==((s=K(this.lastMetadata))==null?void 0:s.id)}shouldRebuildColumnOptions(t){return!dt(t.columnLabels,this.lastMetadata.columnLabels)||!dt(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){dt(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=et(t),t!==null&&this.metadata.update(e=>(e.notetype.value=t,e)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(e=>(e.deck.value=t,e)))}}function Mt(a){const t=we(a),e=Se(a);return[{label:Bt(),value:0,disabled:!1}].concat(a.columnLabels.map((s,l)=>(l+=1,l===t?lt(kt(),!0,l):l===e?lt(Rt(),!0,l):l===a.guidColumn?lt("GUID",!0,l):s===""?lt(a.preview[0].vals[l-1],!1,l,!0):lt(s,!1,l))))}function lt(a,t,e,s){return{label:a?`${e}: ${a}`:e.toString(),shortLabel:s?e.toString():void 0,value:e,disabled:t}}function Se(a){return a.deck.case==="deckColumn"?a.deck.value:null}function we(a){return a.notetype.case==="notetypeColumn"?a.notetype.value:null}const Me=async({params:a})=>{const[t,e,s]=await Promise.all([Ut({}),zt({skipEmptyDefault:!1,includeFiltered:!1}),Et({path:a.path},{alertOnError:!1})]);return{state:new Te(a.path,t,e,s)}},ha=Object.freeze(Object.defineProperty({__proto__:null,load:Me},Symbol.toStringTag,{value:"Module"}));var De=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),He=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Dt(a,t){W(t,!1);const e=rt();let s=w(t,"label",8),l=w(t,"columnOptions",8),o=w(t,"value",12);ye(()=>(St(l()),St(o())),()=>{var v;it(e,(v=l().find(c=>c.value===o()))==null?void 0:v.label)}),_e(),B();var r=He(),i=R(r);Q(i,()=>({"--cols":2})),ot(i.lastChild,{children:(v,c)=>{var n=De(),O=R(n);Q(O,()=>({"--col-size":1})),$t(O.lastChild,{children:(b,m)=>{U();var u=V();D(()=>H(u,s())),p(b,u)},$$slots:{default:!0}}),P(O);var h=T(O,2);Q(h,()=>({"--col-size":1})),$t(h.lastChild,{children:(b,m)=>{be(b,{get label(){return $(e)},get list(){return l()},parser:u=>({content:u.label,value:u.value,disabled:u.disabled}),get value(){return o()},set value(u){o(u)},$$legacy:!0})},$$slots:{default:!0}}),P(h),p(v,n)},$$slots:{default:!0}}),P(i),p(a,r),J()}var Ee=M("<!> <!>",1);function Re(a,t){W(t,!1);const e=nt(),s=()=>E(c,"$globalNotetype",e),l=()=>E(n,"$fieldNamesPromise",e),o=()=>E(O,"$columnOptions",e),r=()=>E(v,"$metadata",e);let i=w(t,"state",8);const v=i().metadata,c=i().globalNotetype,n=i().fieldNames,O=i().columnOptions;B();var h=S(()=>Wt());Nt(a,{get title(){return $(h)},children:(b,m)=>{var u=Ee(),C=R(u);{var y=A=>{var L=yt(),X=R(L);Ne(X,l,null,(x,vt)=>{var Z=yt(),gt=R(Z);pt(gt,1,()=>$(vt),mt,(ut,ft,d)=>{var F=S(()=>d===0?o().slice(1):o());Dt(ut,{get label(){return $(ft)},get columnOptions(){return $(F)},get value(){return s().fieldColumns[d]},set value(f){z(c,N(s).fieldColumns[d]=f,N(s))},$$legacy:!0})}),p(x,Z)}),p(A,L)};_t(C,A=>{s()!==null&&A(y)})}var _=T(C,2),g=S(()=>Jt());Dt(_,{get label(){return $(g)},get columnOptions(){return o()},get value(){return r().tagsColumn},set value(A){z(v,N(r).tagsColumn=A,N(r))},$$legacy:!0}),p(b,u)},$$slots:{default:!0}}),J()}function xe(){return[{label:Kt(),value:Y.TAB},{label:Yt(),value:Y.PIPE},{label:Qt(),value:Y.SEMICOLON},{label:Xt(),value:Y.COLON},{label:Zt(),value:Y.COMMA},{label:te(),value:Y.SPACE}]}function je(){return[{label:ee(),value:ht.UPDATE},{label:ae(),value:ht.PRESERVE},{label:le(),value:ht.DUPLICATE}]}function Ae(){return[{label:kt(),value:It.NOTETYPE},{label:se(),value:It.NOTETYPE_AND_DECK}]}var Le=M('<th class="svelte-13c6kdp"> </th>'),Fe=M('<td class="svelte-13c6kdp"> </td>'),Ge=M('<tr class="svelte-13c6kdp"></tr>'),Ve=M('<div class="outer svelte-13c6kdp"><table class="preview svelte-13c6kdp"><thead><tr class="svelte-13c6kdp"></tr></thead><tbody></tbody></table></div>');function Ue(a,t){W(t,!1);const e=nt(),s=()=>E(i,"$columnOptions",e),l=()=>E(r,"$metadata",e);let o=w(t,"state",8);const r=o().metadata,i=o().columnOptions;B();var v=Ve(),c=at(v),n=at(c),O=at(n);pt(O,5,()=>s().slice(1),mt,(b,m)=>{let u=()=>$(m).label,C=()=>$(m).shortLabel;var y=Le(),_=at(y,!0);P(y),D(()=>H(_,C()||u())),p(b,y)}),P(O),P(n);var h=T(n);pt(h,5,()=>l().preview,mt,(b,m)=>{var u=Ge();pt(u,5,()=>$(m).vals,mt,(C,y)=>{var _=Fe(),g=at(_,!0);P(_),D(()=>H(g,$(y))),p(C,_)}),P(u),p(b,u)}),P(h),P(c),P(v),p(a,v),J()}var ze=M("<!> <!> <!>",1);function qe(a,t){W(t,!1);const e=nt(),s=()=>E(o,"$metadata",e);let l=w(t,"state",8);const o=l().metadata,r={delimiter:{title:oe(),help:re(),url:j.TextImporting.root},isHtml:{title:ie(),help:ne(),url:j.TextImporting.html}},i=Object.values(r);let v=rt(),c=rt();function n(h){$(v).show(),$(c).to(h)}B();var O=S(()=>Ot());Nt(a,{get title(){return $(O)},children:(h,b)=>{var m=ze(),u=R(m),C=S(xe);st(u,{get defaultValue(){return l().defaultDelimiter},get choices(){return $(C)},get disabled(){return s().forceDelimiter},get value(){return s().delimiter},set value(g){z(o,N(s).delimiter=g,N(s))},children:(g,A)=>{q(g,{$$events:{click:()=>n(Object.keys(r).indexOf("delimiter"))},children:(L,X)=>{U();var x=V();D(()=>H(x,r.delimiter.title)),p(L,x)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var y=T(u,2);Ce(y,{get defaultValue(){return l().defaultIsHtml},get disabled(){return s().forceIsHtml},get value(){return s().isHtml},set value(g){z(o,N(s).isHtml=g,N(s))},children:(g,A)=>{q(g,{$$events:{click:()=>n(Object.keys(r).indexOf("isHtml"))},children:(L,X)=>{U();var x=V();D(()=>H(x,r.isHtml.title)),p(L,x)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var _=T(y,2);Ue(_,{get state(){return l()}}),p(h,m)},$$slots:{default:!0,tooltip:(h,b)=>{var m=S(()=>Ot());At(h,{get title(){return $(m)},get url(){return j.TextImporting.root},slot:"tooltip",helpSections:i,$$events:{mount:u=>{it(v,u.detail.modal),it(c,u.detail.carousel)}}})}}}),J()}var Be=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),We=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Ht(a,t){W(t,!1);const e=nt(),s=()=>E(i,"$tagsWritable",e);let l=w(t,"tags",12),o=w(t,"keyCombination",8,void 0),r=w(t,"breakpoint",8,"md");const i=ct(l());B();var v=We(),c=R(v);Q(c,()=>({"--cols":13})),ot(c.lastChild,{children:(n,O)=>{var h=Be(),b=R(h);Q(b,()=>({"--col-size":7})),$t(b.lastChild,{get breakpoint(){return r()},children:(u,C)=>{var y=yt(),_=R(y);qt(_,t,"default",{}),p(u,y)},$$slots:{default:!0}}),P(b);var m=T(b,2);Q(m,()=>({"--col-size":6})),$t(m.lastChild,{get breakpoint(){return r()},children:(u,C)=>{Ie(u,{children:(y,_)=>{Pe(y,{tags:i,get keyCombination(){return o()},$$events:{tagsupdate:({detail:g})=>l(g.tags)}})},$$slots:{default:!0,revert:(y,_)=>{Oe(y,{slot:"revert",defaultValue:[],get value(){return jt(),s()},set value(g){xt(i,g)},$$legacy:!0})}}})},$$slots:{default:!0}}),P(m),p(n,h)},$$slots:{default:!0}}),P(c),p(a,v),J()}var Je=M("<!> <!> <!> <!> <!> <!>",1);function Ke(a,t){W(t,!1);const e=nt(),s=()=>E(v,"$globalNotetype",e),l=()=>E(c,"$deckId",e),o=()=>E(i,"$metadata",e);let r=w(t,"state",8);const i=r().metadata,v=r().globalNotetype,c=r().deckId,n={notetype:{title:kt(),help:ue(),url:j.TextImporting.root},deck:{title:Rt(),help:de(),url:j.TextImporting.root},dupeResolution:{title:ce(),help:pe(),url:j.TextImporting.updating},matchScope:{title:me(),help:$e(),url:j.TextImporting.updating},globalTags:{title:ve(),help:ge(),url:j.TextImporting.root},updatedTags:{title:fe(),help:he(),url:j.TextImporting.root}},O=Object.values(n);let h=rt(),b=rt();function m(C){$(h).show(),$(b).to(C)}B();var u=S(()=>Pt());Nt(a,{get title(){return $(u)},children:(C,y)=>{var _=Je(),g=R(_);{var A=d=>{var F=S(()=>r().notetypeNameIds.map(({id:f,name:G})=>({label:G,value:f})));st(d,{get defaultValue(){return r().defaultNotetypeId},get choices(){return $(F)},get value(){return s().id},set value(f){z(v,N(s).id=f,N(s))},children:(f,G)=>{q(f,{$$events:{click:()=>m(Object.keys(n).indexOf("notetype"))},children:(I,Lt)=>{U();var tt=V();D(()=>H(tt,n.notetype.title)),p(I,tt)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};_t(g,d=>{s()!==null&&d(A)})}var L=T(g,2);{var X=d=>{var F=S(()=>r().deckNameIds.map(({id:f,name:G})=>({label:G,value:f})));st(d,{get defaultValue(){return r().defaultDeckId},get choices(){return $(F)},get value(){return jt(),l()},set value(f){xt(c,f)},children:(f,G)=>{q(f,{$$events:{click:()=>m(Object.keys(n).indexOf("deck"))},children:(I,Lt)=>{U();var tt=V();D(()=>H(tt,n.deck.title)),p(I,tt)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};_t(L,d=>{l()!==null&&d(X)})}var x=T(L,2),vt=S(je);st(x,{defaultValue:0,get choices(){return $(vt)},get value(){return o().dupeResolution},set value(d){z(i,N(o).dupeResolution=d,N(o))},children:(d,F)=>{q(d,{$$events:{click:()=>m(Object.keys(n).indexOf("dupeResolution"))},children:(f,G)=>{U();var I=V();D(()=>H(I,n.dupeResolution.title)),p(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var Z=T(x,2),gt=S(Ae);st(Z,{defaultValue:0,get choices(){return $(gt)},get value(){return o().matchScope},set value(d){z(i,N(o).matchScope=d,N(o))},children:(d,F)=>{q(d,{$$events:{click:()=>m(Object.keys(n).indexOf("matchScope"))},children:(f,G)=>{U();var I=V();D(()=>H(I,n.matchScope.title)),p(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var ut=T(Z,2);Ht(ut,{keyCombination:"Control+T",get tags(){return o().globalTags},set tags(d){z(i,N(o).globalTags=d,N(o))},children:(d,F)=>{q(d,{$$events:{click:()=>m(Object.keys(n).indexOf("globalTags"))},children:(f,G)=>{U();var I=V();D(()=>H(I,n.globalTags.title)),p(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var ft=T(ut,2);Ht(ft,{keyCombination:"Control+Shift+T",get tags(){return o().updatedTags},set tags(d){z(i,N(o).updatedTags=d,N(o))},children:(d,F)=>{q(d,{$$events:{click:()=>m(Object.keys(n).indexOf("updatedTags"))},children:(f,G)=>{U();var I=V();D(()=>H(I,n.updatedTags.title)),p(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),p(C,_)},$$slots:{default:!0,tooltip:(C,y)=>{var _=S(()=>Pt());At(C,{get title(){return $(_)},get url(){return j.TextImporting.root},slot:"tooltip",helpSections:O,$$events:{mount:g=>{it(h,g.detail.modal),it(b,g.detail.carousel)}}})}}}),J()}var Ye=M("<!> <!> <!>",1);function Qe(a,t){W(t,!1);let e=w(t,"state",8);B(),ke(a,{get path(){return e().path},get importer(){return e()},children:(s,l)=>{var o=Ye(),r=R(o);ot(r,{children:(c,n)=>{qe(c,{get state(){return e()}})},$$slots:{default:!0}});var i=T(r,2);ot(i,{children:(c,n)=>{Ke(c,{get state(){return e()}})},$$slots:{default:!0}});var v=T(i,2);ot(v,{children:(c,n)=>{Re(c,{get state(){return e()}})},$$slots:{default:!0}}),p(s,o)},$$slots:{default:!0}}),J()}function ba(a,t){W(t,!1);let e=w(t,"data",8);B(),Qe(a,{get state(){return e().state}}),J()}export{ba as component,ha as universal};
