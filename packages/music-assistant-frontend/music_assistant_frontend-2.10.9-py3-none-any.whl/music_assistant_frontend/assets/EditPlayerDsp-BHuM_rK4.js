import{p as ue,aQ as Te,g as de,t as H,n as t,s as Le,r as R,w as K,a as ae,aW as Me,f as Ue,i as Ne,h as We,l as Ge,c as X,x as le,Q as Pe,y as C,z as T,A as n,X as Z,S as k,J as q,D as ee,E as $e,a2 as Qe,F as ne,aw as je,ax as me,$ as B,B as J,aX as v,o as _e,G as F,K as I,ae as Ke,az as Xe,aY as M,j as Ye,ah as Je,I as ie}from"./index-3OxajW06.js";import{e as Ze}from"./eventbus-CGRXT3Tn.js";import{a as fe,c as Fe,R as qe,b as Ae,S as el,e as Ve,g as ll,f as tl,i as ce,w as L,j as al,l as nl,d as De,n as sl,o as il,q as ol,v as O}from"./VListItem-Chb8UPjb.js";import{b as Q,V as rl}from"./VCardText-DfI0lPZt.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ul}from"./VSlider-B2fjwCeW.js";import{V as dl}from"./VTextField-PZO_9G2I.js";import{V as j,b as oe,a as ml}from"./VCard-BtLQOX9b.js";import{b as fl,a as Ce}from"./VChip-CJqEYpNt.js";import{V as re,a as Oe}from"./VSwitch-sNb6LYuZ.js";import{V as we}from"./VSpacer-D0kMQk_0.js";import{V as Ee}from"./VContainer-D9OC0DI7.js";import{V as ke,a as he}from"./VToolbar-HzJOtCLw.js";import{V as cl}from"./VDialog-DHN-Ek7A.js";import{V as pl}from"./VAlert-CbrNX-A8.js";import{V as vl,a as Se}from"./VRow-CFzciOM8.js";import{V as gl}from"./VCheckbox-Dp9AwJQb.js";import"./VCheckboxBtn-Be-snH-E.js";import"./VMenu-BqhB0qWS.js";import"./VList-6o6GYwqq.js";import"./VVirtualScroll-DVYtO6nk.js";/* empty css              */const yl=ue({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:Te,iconColor:String,lineColor:String,...fe(),...Fe(),...qe(),...Ae()},"VTimelineDivider"),bl=de()({name:"VTimelineDivider",props:yl(),setup(l,g){let{slots:m}=g;const{sizeClasses:o,sizeStyles:s}=el(l,"v-timeline-divider__dot"),{backgroundColorStyles:h,backgroundColorClasses:S}=Ve(H(l,"dotColor")),{roundedClasses:f}=ll(l,"v-timeline-divider__dot"),{elevationClasses:_}=tl(l),{backgroundColorClasses:y,backgroundColorStyles:P}=Ve(H(l,"lineColor"));return ce(()=>t("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":l.fillDot},l.class],style:l.style},[t("div",{class:["v-timeline-divider__before",y.value],style:P.value},null),!l.hideDot&&t("div",{key:"dot",class:["v-timeline-divider__dot",_.value,f.value,o.value],style:s.value},[t("div",{class:["v-timeline-divider__inner-dot",S.value,f.value],style:h.value},[m.default?t(al,{key:"icon-defaults",disabled:!l.icon,defaults:{VIcon:{color:l.iconColor,icon:l.icon,size:l.size}}},m.default):t(L,{key:"icon",color:l.iconColor,icon:l.icon,size:l.size},null)])]),t("div",{class:["v-timeline-divider__after",y.value],style:P.value},null)])),{}}}),Re=ue({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:Te,iconColor:String,lineInset:[Number,String],...fe(),...nl(),...Ae(),...Fe(),...qe(),...De()},"VTimelineItem"),Y=de()({name:"VTimelineItem",props:Re(),setup(l,g){let{slots:m}=g;const{dimensionStyles:o}=sl(l),s=Le(0),h=R();return K(h,S=>{var f;S&&(s.value=((f=S.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:f.getBoundingClientRect().width)??0)},{flush:"post"}),ce(()=>{var S,f;return t("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":l.fillDot},l.class],style:[{"--v-timeline-dot-size":ae(s.value),"--v-timeline-line-inset":l.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${ae(l.lineInset)})`:ae(0)},l.style]},[t("div",{class:"v-timeline-item__body",style:o.value},[(S=m.default)==null?void 0:S.call(m)]),t(bl,{ref:h,hideDot:l.hideDot,icon:l.icon,iconColor:l.iconColor,size:l.size,elevation:l.elevation,dotColor:l.dotColor,fillDot:l.fillDot,rounded:l.rounded},{default:m.icon}),l.density!=="compact"&&t("div",{class:"v-timeline-item__opposite"},[!l.hideOpposite&&((f=m.opposite)==null?void 0:f.call(m))])])}),{}}}),_l=ue({align:{type:String,default:"center",validator:l=>["center","start"].includes(l)},direction:{type:String,default:"vertical",validator:l=>["vertical","horizontal"].includes(l)},justify:{type:String,default:"auto",validator:l=>["auto","center"].includes(l)},side:{type:String,validator:l=>l==null||["start","end"].includes(l)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:l=>["start","end","both"].includes(l)},...Me(Re({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...fe(),...il(),...De(),...Ue()},"VTimeline"),Vl=de()({name:"VTimeline",props:_l(),setup(l,g){let{slots:m}=g;const{themeClasses:o}=Ne(l),{densityClasses:s}=ol(l),{rtlClasses:h}=We();Ge({VTimelineDivider:{lineColor:H(l,"lineColor")},VTimelineItem:{density:H(l,"density"),dotColor:H(l,"dotColor"),fillDot:H(l,"fillDot"),hideOpposite:H(l,"hideOpposite"),iconColor:H(l,"iconColor"),lineColor:H(l,"lineColor"),lineInset:H(l,"lineInset"),size:H(l,"size")}});const S=X(()=>{const _=l.side?l.side:l.density!=="default"?"end":null;return _&&`v-timeline--side-${_}`}),f=X(()=>{const _=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(l.truncateLine){case"both":return _;case"start":return _[0];case"end":return _[1];default:return null}});return ce(()=>t(l.tag,{class:["v-timeline",`v-timeline--${l.direction}`,`v-timeline--align-${l.align}`,`v-timeline--justify-${l.justify}`,f.value,{"v-timeline--inset-line":!!l.lineInset},o.value,s.value,S.value,h.value,l.class],style:[{"--v-timeline-line-thickness":ae(l.lineThickness)},l.style]},m)),{}}}),Cl=le({__name:"DSPPipeline",props:{dsp:{},selected:{}},emits:["onSelect","onAddFilter","onMoveFilter","onDeleteFilter"],setup(l,{emit:g}){const m=Pe(),o=l,s=g,h=p=>o.selected===p?"primary":"secondary",S=p=>p==="input"||p==="output"?!1:!o.dsp.filters[p].enabled,f=p=>o.selected===p?"primary":m.global.current.value.dark?"grey-darken-3":"grey-lighten-3",_=p=>({"filter-selected":o.selected===p}),y=p=>{s("onSelect",p)},P=(p,c)=>{s("onMoveFilter",{index:p,direction:c})},z=p=>{s("onDeleteFilter",p)},N=function(p,c){const $=[{label:"settings.dsp.move_up",labelArgs:[],action:()=>{P(c,"up")},disabled:c===0,icon:"mdi-arrow-up"},{label:"settings.dsp.move_down",labelArgs:[],action:()=>{P(c,"down")},disabled:c===o.dsp.filters.length-1,icon:"mdi-arrow-down"},{label:"settings.dsp.delete_filter",labelArgs:[],action:()=>{z(c)},icon:"mdi-delete"}];Ze.emit("contextmenu",{items:$,posX:p.clientX,posY:p.clientY})};return(p,c)=>(C(),T(Vl,{density:"compact",side:"end"},{default:n(()=>[t(Y,{"dot-color":h("input"),size:"x-small",onClick:c[0]||(c[0]=$=>y("input"))},{default:n(()=>[t(O,{flat:"",rounded:"pill",color:f("input"),class:Z([_("input"),"dsp-pipeline-card"])},{default:n(()=>[t(Q,{class:"px-3 py-1"},{default:n(()=>[k(q(p.$t("settings.dsp.input")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"]),t(Y,{"hide-dot":!0,size:"x-small"}),(C(!0),ee(ne,null,$e(p.dsp.filters,($,w)=>(C(),T(Y,{key:w,"dot-color":h(w),size:"x-small","hide-dot":S(w),onClick:r=>y(w),onContextmenu:Qe(r=>N(r,w),["prevent"])},{default:n(()=>[t(O,{flat:"",rounded:"pill",color:f(w),class:Z([_(w),"dsp-pipeline-card"])},{default:n(()=>[t(Q,{class:"px-3 py-1"},{default:n(()=>[k(q(p.$t(`settings.dsp.types.${$.type}`)),1)]),_:2},1024)]),_:2},1032,["color","class"])]),_:2},1032,["dot-color","hide-dot","onClick","onContextmenu"]))),128)),t(Y,{"dot-color":"secondary",size:"x-small","hide-dot":!0},{default:n(()=>[t(O,{outlined:"",rounded:"pill",class:"dsp-pipeline-card add-filter-btn",elevation:0,onClick:c[1]||(c[1]=$=>s("onAddFilter"))},{default:n(()=>[t(Q,{class:"py-1 d-flex align-center"},{default:n(()=>[t(L,{size:"small",class:"mr-1"},{default:n(()=>c[3]||(c[3]=[k("mdi-plus")])),_:1}),k(" "+q(p.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1}),t(Y,{"hide-dot":!0,size:"x-small"}),t(Y,{"dot-color":h("output"),size:"x-small",onClick:c[2]||(c[2]=$=>y("output"))},{default:n(()=>[t(O,{flat:"",rounded:"pill",color:f("output"),class:Z([_("output"),"dsp-pipeline-card"])},{default:n(()=>[t(Q,{class:"px-3 py-1"},{default:n(()=>[k(q(p.$t("settings.dsp.output")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"])]),_:1}))}}),kl=Ie(Cl,[["__scopeId","data-v-f292f100"]]),hl={style:{"min-width":"100px"},class:"v-label pl-2"},Sl={style:{"min-width":"40px"},class:"pl-2"},U=le({__name:"DSPSlider",props:je({type:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const g=l,m=me(l,"modelValue"),o=R(!1),s=X(()=>g.type==="gain"?{min:-15,max:15,step:.1,label:B("settings.dsp.parameter.gain"),unit:"dB"}:g.type==="q"?{min:.1,max:20,step:.1,label:B("settings.dsp.parameter.q_factor"),unit:""}:g.type==="frequency"?{min:20,max:2e4,step:1,label:B("settings.dsp.parameter.frequency"),unit:"Hz"}:g.type),h=X({get:()=>o.value?m.value.toString():m.value>1e3?m.value.toFixed(0):m.value>100?m.value.toFixed(1):m.value.toFixed(2),set:S=>{m.value=Number(S)}});return(S,f)=>(C(),T(j,{flat:"",color:"transparent"},{default:n(()=>[t(Q,{class:"d-flex align-center gap-4"},{default:n(()=>[J("span",hl,q(s.value.label),1),t(ul,{modelValue:m.value,"onUpdate:modelValue":f[0]||(f[0]=_=>m.value=_),min:s.value.min,max:s.value.max,step:s.value.step,"hide-details":"",class:"flex-grow-1 pr-4",density:"compact",color:"primary"},null,8,["modelValue","min","max","step"]),t(dl,{modelValue:h.value,"onUpdate:modelValue":f[1]||(f[1]=_=>h.value=_),type:"number","hide-details":"",density:"compact",style:{"max-width":"100px"},onFocus:f[2]||(f[2]=_=>o.value=!0),onBlur:f[3]||(f[3]=_=>o.value=!1)},null,8,["modelValue"]),J("span",Sl,q(s.value.unit),1)]),_:1})]),_:1}))}}),Tl={class:"d-flex align-center"},Pl=le({__name:"DSPParametricEQ",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(l){const g={PK:v.PEAK,PEQ:v.PEAK,HP:v.HIGH_PASS,HPQ:v.HIGH_PASS,LP:v.LOW_PASS,LPQ:v.LOW_PASS,LS:v.LOW_SHELF,HS:v.HIGH_SHELF,NO:v.NOTCH},m={[v.PEAK]:"PK",[v.HIGH_PASS]:"HP",[v.LOW_PASS]:"LP",[v.LOW_SHELF]:"LS",[v.HIGH_SHELF]:"HS",[v.NOTCH]:"NO"},o=i=>{const e=i.split(`
`),u=[];for(const b of e)if(b.startsWith("Filter")){const V=b.match(/Filter(?:\s+\d+)?:\s+(ON|OFF)\s+(\w+)\s+(?:Fc\s+)?(\d+\.?\d*)\s*(?:Hz)?\s+(?:Gain\s+)?(-?\d+\.?\d*)\s+dB\s+(?:(?:Q\s+)?(\d+\.?\d*)|(?:BW\s+Oct\s+)(\d+\.?\d*))/);if(V){const[D,W,G,A,x,ve,ge]=V;G!=="None"&&u.push({frequency:parseFloat(A),gain:parseFloat(x),q:parseFloat(ve),type:g[G]||v.PEAK,enabled:W==="ON"})}}y.value.bands=u,a.value=0},s=i=>{const e=i.target;if(e.files&&e.files[0]){const u=e.files[0],b=new FileReader;b.onload=V=>{var D;(D=V.target)!=null&&D.result&&o(V.target.result)},b.readAsText(u)}},h=R(null),S=()=>{var i;(i=h.value)==null||i.click()},f=()=>{let i=`Preamp: 0 dB
`;y.value.bands.forEach(V=>{const D=m[V.type];i+=`Filter: ${V.enabled?"ON":"OFF"} ${D} Fc ${V.frequency.toFixed(1)} Hz Gain ${V.gain.toFixed(2)} dB Q ${V.q.toFixed(3)}
`});const e=new Blob([i],{type:"text/plain"}),u=URL.createObjectURL(e),b=document.createElement("a");b.href=u,b.download=`music_assistant_eq_settings_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(u)},_=Pe(),y=me(l,"modelValue"),P=R(null),z=R(null),N=Object.values(v).map(i=>({title:B(`settings.dsp.parametric_eq.filter_types.${i}`),value:i})),p=i=>![v.HIGH_PASS,v.LOW_PASS,v.NOTCH].includes(i),c=R({width:0,height:0,min_gain:-20,max_gain:20,min_freq:20,max_freq:2e4,padding_lr:40,padding_tb:20}),$=()=>{if(!P.value||!z.value)return;const i=_.global.current.value.dark,e=P.value.getContext("2d");if(!e)return;P.value.width=z.value.clientWidth*2,P.value.height=z.value.clientHeight*2,c.value.width=P.value.width/2,c.value.height=P.value.height/2,e.scale(2,2),e.clearRect(0,0,P.value.width,P.value.height),Be(e,c.value);const u=e.canvas.width/2;e.canvas.height/2;const b=new Float32Array(u);y.value.bands.forEach((V,D)=>{if(V.enabled){let W=`hsla(${D*360/y.value.bands.length}, 60%, ${i?70:50}%, 0.5)`;e.beginPath(),D===a.value?(e.lineWidth=5,W=`hsla(${D*360/y.value.bands.length}, 70%, ${i?70:60}%, 1)`):e.lineWidth=2,e.strokeStyle=W;const G=new Float32Array(u);for(let E=0;E<u;E++)G[E]=He(E,c.value);const A=new Float32Array(u),x=new Float32Array(u);w(r,V).getFrequencyResponse(G,A,x);for(let E=c.value.padding_lr;E<u-c.value.padding_lr;E++){const ye=20*Math.log10(A[E]);b[E]+=ye;const be=te(ye,c.value);E===0?e.moveTo(E,be):e.lineTo(E,be)}e.stroke();const ge=pe(V.frequency,c.value),ze=te(V.gain,c.value);e.beginPath(),e.fillStyle=W,e.arc(ge,ze,6,0,2*Math.PI),e.fill()}}),e.lineWidth=2,i?e.strokeStyle="#fff":e.strokeStyle="#000",e.beginPath();for(let V=c.value.padding_lr;V<u-c.value.padding_lr;V++){const D=te(b[V],c.value);V===0?e.moveTo(V,D):e.lineTo(V,D)}e.stroke()},w=(i,e)=>{const u=i.createBiquadFilter();switch(e.type){case v.HIGH_PASS:u.type="highpass";break;case v.LOW_PASS:u.type="lowpass";break;case v.HIGH_SHELF:u.type="highshelf";break;case v.LOW_SHELF:u.type="lowshelf";break;case v.NOTCH:u.type="notch";break;case v.PEAK:u.type="peaking";break}return u.frequency.value=e.frequency,u.Q.value=e.q,u.gain.value=e.gain,u},r=new AudioContext;X(()=>y.value.bands.map(i=>w(r,i)));const a=R(0),d=X(()=>y.value.bands[a.value]),se=i=>{y.value.bands.splice(i,1),a.value>=y.value.bands.length&&(a.value=y.value.bands.length-1)},xe=()=>{const i=y.value.bands.length;y.value.bands.push({frequency:1e3,q:1,gain:0,type:v.PEAK,enabled:!0}),a.value=i};K(()=>y.value.bands,$,{deep:!0}),K(()=>a.value,$),K(()=>_.global.current.value.dark,$),_e(()=>{$(),window.addEventListener("resize",$)});const pe=(i,e)=>{const u=Math.log2(i/e.min_freq),b=Math.log2(e.max_freq/e.min_freq);return u/b*(e.width-e.padding_lr*2)+e.padding_lr},He=(i,e)=>{const u=Math.log2(e.max_freq/e.min_freq),b=e.min_freq*Math.pow(2,(i-e.padding_lr)/(e.width-e.padding_lr*2)*u);return Math.min(Math.max(b,e.min_freq),e.max_freq)},te=(i,e)=>e.height/2-i*(e.height-2*e.padding_tb)/(2*Math.max(Math.abs(e.min_gain),Math.abs(e.max_gain))),Be=(i,e)=>{const u=i.canvas.width/2,b=i.canvas.height/2;_.global.current.value.dark?(i.fillStyle="#eee",i.strokeStyle="#eee"):(i.fillStyle="#222",i.strokeStyle="#666"),i.lineWidth=1,[20,50,100,200,500,1e3,2e3,5e3,1e4,2e4].forEach(A=>{const x=pe(A,e);i.beginPath(),i.moveTo(x,e.padding_tb),i.lineTo(x,b-e.padding_tb),i.stroke(),i.font="10px Arial",i.textAlign="center",i.fillText(A>=1e3?`${A/1e3}k`:A.toString(),x,b-5)});const W=e.max_gain-e.min_gain,G=Math.ceil(W/(e.height/30));for(let A=e.min_gain;A<=e.max_gain;A+=G){const x=te(A,e);i.beginPath(),i.moveTo(e.padding_lr,x),i.lineTo(u-e.padding_lr,x),i.stroke(),i.font="10px Arial",i.textAlign="right",i.fillText(`${A}dB`,e.padding_lr-3,x+3)}};return _e(()=>{const i=new ResizeObserver(()=>{$()});return z.value&&i.observe(z.value),()=>{i.disconnect()}}),(i,e)=>(C(),T(Ee,{class:"pa-2"},{default:n(()=>[t(oe,{class:"d-flex justify-end"},{default:n(()=>[t(O,{variant:"outlined",class:"mr-2",onClick:S},{default:n(()=>[t(L,{start:""},{default:n(()=>e[7]||(e[7]=[k("mdi-file-import")])),_:1}),k(" "+q(F(B)("settings.dsp.parametric_eq.import_apo")),1)]),_:1}),t(O,{variant:"outlined",class:"mr-2",onClick:f},{default:n(()=>[t(L,{start:""},{default:n(()=>e[8]||(e[8]=[k("mdi-file-export")])),_:1}),k(" "+q(F(B)("settings.dsp.parametric_eq.export_apo")),1)]),_:1}),J("input",{ref_key:"fileInputRef",ref:h,type:"file",accept:".txt",class:"d-none",onChange:s},null,544)]),_:1}),t(j,{elevation:"0",color:"transparent"},{default:n(()=>[J("div",{ref_key:"graphContainer",ref:z,class:"graph-container"},[J("canvas",{ref_key:"canvas",ref:P,class:"frequency-graph"},null,512)],512)]),_:1}),t(j,{elevation:"0",color:"transparent",class:"border-t border-b rounded-0"},{default:n(()=>[t(Q,{class:"pa-0"},{default:n(()=>[t(fl,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=u=>a.value=u),class:"mb-0 pa-2",mandatory:"","selected-class":"primary"},{default:n(()=>[(C(!0),ee(ne,null,$e(y.value.bands,(u,b)=>(C(),T(Ce,{key:b,value:b,class:Z({"opacity-50":!u.enabled}),filter:"",variant:"elevated"},{default:n(()=>[k(q(F(B)("settings.dsp.parametric_eq.band",{index:b+1})),1)]),_:2},1032,["value","class"]))),128)),t(Ce,{variant:"outlined",onClick:xe},{default:n(()=>[t(L,{icon:"mdi-plus",start:""}),k(" "+q(F(B)("settings.dsp.parametric_eq.add_band")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),d.value?(C(),ee(ne,{key:0},[t(oe,null,{default:n(()=>[J("div",Tl,[t(re,{modelValue:d.value.enabled,"onUpdate:modelValue":e[1]||(e[1]=u=>d.value.enabled=u),label:F(B)("settings.dsp.parametric_eq.enable_band"),density:"comfortable","hide-details":"",color:"primary"},null,8,["modelValue","label"]),t(we),t(O,{color:"error",variant:"tonal",onClick:e[2]||(e[2]=u=>se(a.value))},{default:n(()=>[t(L,null,{default:n(()=>e[9]||(e[9]=[k("mdi-delete")])),_:1}),k(" "+q(F(B)("settings.dsp.parametric_eq.delete_band")),1)]),_:1})])]),_:1}),t(Oe,{modelValue:d.value.type,"onUpdate:modelValue":e[3]||(e[3]=u=>d.value.type=u),items:F(N),label:F(B)("settings.dsp.parametric_eq.filter_type"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"]),t(U,{modelValue:d.value.frequency,"onUpdate:modelValue":e[4]||(e[4]=u=>d.value.frequency=u),type:"frequency"},null,8,["modelValue"]),p(d.value.type)?(C(),T(U,{key:0,modelValue:d.value.gain,"onUpdate:modelValue":e[5]||(e[5]=u=>d.value.gain=u),type:"gain"},null,8,["modelValue"])):I("",!0),t(U,{modelValue:d.value.q,"onUpdate:modelValue":e[6]||(e[6]=u=>d.value.q=u),type:"q"},null,8,["modelValue"])],64)):I("",!0)]),_:1}))}}),$l=Ie(Pl,[["__scopeId","data-v-34727d88"]]),Fl=le({__name:"DSPToneControl",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(l){const g=me(l,"modelValue");return(m,o)=>(C(),ee(ne,null,[t(U,{modelValue:g.value.bass_level,"onUpdate:modelValue":o[0]||(o[0]=s=>g.value.bass_level=s),type:{min:-10,max:10,step:.1,label:m.$t("settings.dsp.tone_control.bass_level"),unit:"dB"}},null,8,["modelValue","type"]),t(U,{modelValue:g.value.mid_level,"onUpdate:modelValue":o[1]||(o[1]=s=>g.value.mid_level=s),type:{min:-10,max:10,step:.1,label:m.$t("settings.dsp.tone_control.mid_level"),unit:"dB"}},null,8,["modelValue","type"]),t(U,{modelValue:g.value.treble_level,"onUpdate:modelValue":o[2]||(o[2]=s=>g.value.treble_level=s),type:{min:-10,max:10,step:.1,label:m.$t("settings.dsp.tone_control.treble_level"),unit:"dB"}},null,8,["modelValue","type"])],64))}}),ql={key:0},Jl=le({__name:"EditPlayerDsp",props:{playerId:{}},setup(l){const{t:g}=Ke();Xe();const m=l,o=R(),s=R(null),h=R(!1),S=R(M.PARAMETRIC_EQ);R(window.innerWidth);const{mobile:f}=Ye(),_=Object.values(M).map(r=>({value:r,title:g(`settings.dsp.types.${r}`)})),y=r=>{s.value=r},P=r=>{var a;return g(r==="input"?"settings.dsp.input":r==="output"?"settings.dsp.output":`settings.dsp.types.${(a=o.value)==null?void 0:a.filters[r].type}`)},z=()=>{if(!o.value)return;let r;switch(S.value){case M.PARAMETRIC_EQ:r={enabled:!0,type:M.PARAMETRIC_EQ,bands:[]};break;case M.TONE_CONTROL:r={enabled:!0,type:M.TONE_CONTROL,bass_level:0,mid_level:0,treble_level:0};break;default:return}o.value.filters.push(r),h.value=!1,y(o.value.filters.length-1)},N=(r,a)=>{if(!o.value)return;const d=a==="up"?r-1:r+1;if(d<0||d>=o.value.filters.length)return;const[se]=o.value.filters.splice(r,1);o.value.filters.splice(d,0,se),s.value===r?s.value=d:s.value===d&&(s.value=r)},p=r=>{var a;s.value===r&&(s.value="input"),(a=o.value)==null||a.filters.splice(r,1)};K(f,r=>{!r&&s.value===null&&y("input")},{immediate:!0});const c=X(()=>Je(ie.players[m.playerId],27));K(()=>m.playerId,async r=>{r&&(o.value=await ie.getDSPConfig(r))},{immediate:!0});let $=null;const w=r=>{$&&clearTimeout($),$=setTimeout(async()=>{m.playerId&&await ie.saveDSPConfig(m.playerId,r)},2e3)};return K(o,(r,a)=>{r!==null&&a&&w(a)},{deep:!0}),(r,a)=>o.value?(C(),ee("section",ql,[t(ke,{color:"transparent",class:"border-b"},{default:n(()=>[t(re,{modelValue:o.value.enabled,"onUpdate:modelValue":a[0]||(a[0]=d=>o.value.enabled=d),"hide-details":"",color:"primary",class:"pl-4"},null,8,["modelValue"]),t(he,null,{default:n(()=>[k(q(r.$t("settings.dsp.configure_on",{name:c.value})),1)]),_:1})]),_:1}),t(Ee,{class:"pa-4"},{default:n(()=>[o.value.enabled?I("",!0):(C(),T(pl,{key:0,type:"info",class:"mt-4",color:"transparent"},{default:n(()=>[k(q(r.$t("settings.dsp.disabled_message")),1)]),_:1})),t(vl,{class:Z([{"justify-center":F(f)},"flex-nowrap"])},{default:n(()=>[!F(f)||s.value===null?(C(),T(Se,{key:0,class:Z(["flex-grow-0 flex-shrink-0",{"border-e pr-4":!F(f)}]),"align-self":"start"},{default:n(()=>[t(kl,{dsp:o.value,selected:s.value,onOnSelect:y,onOnAddFilter:a[1]||(a[1]=d=>h.value=!0),onOnMoveFilter:a[2]||(a[2]=d=>N(d.index,d.direction)),onOnDeleteFilter:p},null,8,["dsp","selected"])]),_:1},8,["class"])):I("",!0),s.value!=null?(C(),T(Se,{key:1,style:{"min-width":"0"}},{default:n(()=>[t(ke,{density:"compact",color:r.$vuetify.theme.current.dark?"surface":"surface-light",class:"border-b"},{default:n(()=>[F(f)?(C(),T(O,{key:0,class:"hidden-xs-only",icon:"",onClick:a[3]||(a[3]=d=>s.value=null)},{default:n(()=>[t(L,null,{default:n(()=>a[16]||(a[16]=[k("mdi-arrow-left")])),_:1})]),_:1})):I("",!0),t(he,null,{default:n(()=>[k(q(P(s.value)),1)]),_:1}),typeof s.value=="number"&&!F(f)&&s.value>0?(C(),T(O,{key:1,icon:"",onClick:a[4]||(a[4]=d=>N(s.value,"up"))},{default:n(()=>[t(L,null,{default:n(()=>a[17]||(a[17]=[k("mdi-arrow-up")])),_:1})]),_:1})):I("",!0),typeof s.value=="number"&&!F(f)&&s.value<o.value.filters.length-1?(C(),T(O,{key:2,icon:"",onClick:a[5]||(a[5]=d=>N(s.value,"down"))},{default:n(()=>[t(L,null,{default:n(()=>a[18]||(a[18]=[k("mdi-arrow-down")])),_:1})]),_:1})):I("",!0),typeof s.value=="number"?(C(),T(re,{key:3,modelValue:o.value.filters[s.value].enabled,"onUpdate:modelValue":a[6]||(a[6]=d=>o.value.filters[s.value].enabled=d),"hide-details":"",color:"primary",class:"mr-4"},null,8,["modelValue"])):I("",!0),typeof s.value=="number"?(C(),T(O,{key:4,icon:"",onClick:a[7]||(a[7]=d=>p(s.value))},{default:n(()=>[t(L,null,{default:n(()=>a[19]||(a[19]=[k("mdi-delete")])),_:1})]),_:1})):I("",!0)]),_:1},8,["color"]),s.value==="input"?(C(),T(j,{key:0,flat:"",color:r.$vuetify.theme.current.dark?"surface":"surface-light"},{default:n(()=>[t(U,{modelValue:o.value.input_gain,"onUpdate:modelValue":a[8]||(a[8]=d=>o.value.input_gain=d),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):s.value==="output"?(C(),T(j,{key:1,flat:"",color:r.$vuetify.theme.current.dark?"surface":"surface-light"},{default:n(()=>[t(U,{modelValue:o.value.output_gain,"onUpdate:modelValue":a[9]||(a[9]=d=>o.value.output_gain=d),type:"gain"},null,8,["modelValue"]),t(oe,null,{default:n(()=>[t(gl,{modelValue:o.value.output_limiter,"onUpdate:modelValue":a[10]||(a[10]=d=>o.value.output_limiter=d),label:r.$t("settings.dsp.enable_output_limiter"),"hide-details":""},null,8,["modelValue","label"])]),_:1})]),_:1},8,["color"])):(C(),T(j,{key:2,flat:"",color:r.$vuetify.theme.current.dark?"surface":"surface-light"},{default:n(()=>[o.value.filters[s.value].type===F(M).PARAMETRIC_EQ?(C(),T($l,{key:0,modelValue:o.value.filters[s.value],"onUpdate:modelValue":a[11]||(a[11]=d=>o.value.filters[s.value]=d)},null,8,["modelValue"])):I("",!0),o.value.filters[s.value].type===F(M).TONE_CONTROL?(C(),T(Fl,{key:1,modelValue:o.value.filters[s.value],"onUpdate:modelValue":a[12]||(a[12]=d=>o.value.filters[s.value]=d)},null,8,["modelValue"])):I("",!0)]),_:1},8,["color"]))]),_:1})):I("",!0)]),_:1},8,["class"])]),_:1}),t(cl,{modelValue:h.value,"onUpdate:modelValue":a[15]||(a[15]=d=>h.value=d),"max-width":"300"},{default:n(()=>[t(j,null,{default:n(()=>[t(rl,null,{default:n(()=>[k(q(r.$t("settings.dsp.filter.add")),1)]),_:1}),t(Q,null,{default:n(()=>[t(Oe,{modelValue:S.value,"onUpdate:modelValue":a[13]||(a[13]=d=>S.value=d),items:F(_),label:r.$t("settings.dsp.filter.type")},null,8,["modelValue","items","label"])]),_:1}),t(ml,null,{default:n(()=>[t(we),t(O,{onClick:a[14]||(a[14]=d=>h.value=!1)},{default:n(()=>[k(q(r.$t("cancel")),1)]),_:1}),t(O,{color:"primary",onClick:z},{default:n(()=>[k(q(r.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):I("",!0)}});export{Jl as default};
