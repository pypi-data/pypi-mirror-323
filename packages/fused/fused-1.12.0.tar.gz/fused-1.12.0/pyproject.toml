[build-system]
requires = ["poetry-core>=2.0.0", "poetry-dynamic-versioning"]
build-backend = "poetry_dynamic_versioning.backend"

[project]
name = "fused"
dynamic = ["dependencies"]
description = ""
authors = []
readme = "README.md"
version = "1.12.0"

[tool.poetry]
# Version is set to 0.0.0 as the version string is automatically generated by
# https://github.com/mtkennerly/poetry-dynamic-versioning
packages = [
    { include = "fused" },
    { include = "fused_batch" },
]

[project.urls]
Homepage = "https://www.fused.io"
Documentation = "https://docs.fused.io"
# Repository = "https://github.com/fusedlabs/fused-py"
# Issues = "https://github.com/fusedlabs/fused-py/issues"
Changelog = "https://docs.fused.io/python-sdk/changelog/"

[tool.versioning]
migration_version = "0.0.3"

[tool.poetry.dependencies]
python = ">=3.9,<4"
pydantic = "^2.7.0"
requests = "^2.31"
aiohttp = "^3.8.3"
yarl = "^1.9.4"

# TODO: Make optional
# Job dependencies
loguru = {version = "^0.6.0"}
pyarrow = {version = ">=11"}
numpy = {version = ">=1.20"}

rtoml = {version = "^0", markers = "sys_platform != 'emscripten'"}

shapely = {version = "^2", optional = true}
geopandas = {version = "^0.14", optional = true}
fsspec = {version = "^2024.3.1", optional = true}
affine = {version = "^2", optional = true}
pyproj = {version = "^3.3", optional = true}
importlib-resources = {version = "^5.12.0", optional = true}
# Xarray
# An older version is listed here to maintain Python 3.8 compatability
pandas = [
    {version = "<2", python = "=3.8", optional = true},
    {version = "^2.2.0", python = ">=3.9", optional = true}
]
xarray = [
    {version = "^2023.01.0", python = "=3.8", optional = true},
    {version = "2024.3.0", python = ">=3.9", optional = true}
]
jinja2 = {version = "^3.1.2", optional = true}
mercantile = {version ="^1.2.1", optional = true}

[tool.poetry.extras]
batch = [
    "shapely",
    "geopandas",
    "fsspec",
    "affine",
    "pyproj",
    "importlib-resources",
    "pandas",
    "xarray",
    "jinja2",
    "mercantile",
]

[tool.poetry.group.dev.dependencies]
# Set black to exact pin because it uses calendar versioning
# Note that this should match the version in .pre-commit-config.yaml
black = {version = "23.7.0", extras = ["jupyter"]}
isort = "^5.12.0"
ipykernel = "^6.22.0"
# https://github.com/ipython/ipython/issues/14051
ipython = "^8.7.0,<8.12.1"
mypy = "^1"
types-requests = "^2.29.0.0"
pytest = "^7.3.1"
pre-commit = "^3.3.1"
pytest-httpserver = "^1.0.8"
coverage = "^7.3.1"

[tool.poetry.group.test.dependencies]
h3 = "4.0.0b3"
contextily = ">=1.3.0"

[tool.poetry-dynamic-versioning]
enable = false
vcs = "git"
# This makes strings like `1.3.2.dev3+28c1684` instead of `1.3.1.post3.dev0+28c1684`
bump = true

[tool.poetry-dynamic-versioning.substitution]
folders = [
    { path = "fused" }
]


[tool.isort]
profile = "black"


[tool.ruff]
ignore = [
    "E501", # Line length
]
target-version = "py38"

[tool.mypy]
plugins = "pydantic.mypy"

[tool.coverage.run]
omit = [
    "tests_batch/*",
]

[tool.pytest.ini_options]
markers = [
  "require_auth: tests that require an authenticated API (locally, or with refresh token on CI)",
]
