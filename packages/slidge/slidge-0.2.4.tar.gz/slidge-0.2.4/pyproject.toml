[project]
name = "slidge"
description = "XMPP bridging framework"
requires-python = ">= 3.11"
dependencies = [
    "aiohttp[speedups]>=3.11.11",
    "alembic>=1.14.0",
    "configargparse>=1.7",
    "defusedxml>=0.7.1",
    "pickle-secure>=0.99.9",
    "pillow>=11.0.0",
    "python-magic>=0.4.27",
    "qrcode>=8.0",
    "slixmpp>=1.8.6",
    "sqlalchemy>=2.0.36",
    "thumbhash>=0.1.2",
]
authors = [
  {name = "Nicolas Cedilnik", email = "nicoco@nicoco.fr"},
]
license = {file = "LICENSE"}
classifiers = [
    "Topic :: Internet :: XMPP",
    "Topic :: Software Development :: Libraries :: Python Modules",
]
keywords = ["xmpp", "gateway", "bridge", "instant messaging"]
version = "v0.2.4"
readme = "README.md"

[build-system]
requires = ["setuptools", "setuptools-scm"]
build-backend = "setuptools.build_meta"

[tool.setuptools.packages.find]
include = ["slidge*"]

[project.scripts]
slidge = 'slidge.main:main'

[project.urls]
Homepage = "https://codeberg.org/slidge/"
Issues = "https://codeberg.org/slidge/slidge/issues"
Repository = "https://codeberg.org/slidge/slidge/"
"Chat room" = "https://conference.nicoco.fr:5281/muc_log/slidge/"
Documentation = "https://slidge.codeberg.page/docs/main"

[dependency-groups]
dev = [
    "coverage>=7.6.10",
    "emoji>=2.14.0",
    "furo>=2024.8.6",
    "mypy>=1.14.1",
    "pre-commit>=4.0.1",
    "pygments>=2.18.0",
    "pytest>=8.3.4",
    "pytest-asyncio>=0.25.0",
    "ruff>=0.8.4",
    "sphinx>=8.1.3",
    "sphinx-argparse>=0.5.2",
    "sphinx-autoapi>=3.4.0",
    "types-pillow>=10.2.0.20240822",
    "utidylib>=0.10",
    "xmldiff>=2.7.0",
]

[tool.mypy]
check_untyped_defs = true
files = ["slidge", "superduper"]
exclude = ["tests"]

[[tool.mypy.overrides]]
module = [
    "thumbhash",
    "configargparse",
    "qrcode",
]
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "slidge.slixfix.*"
ignore_errors = true

[tool.ruff]
line-length = 88
exclude = ["xep_*", "tests"]

[tool.ruff.lint]
select = ["I"]

[tool.coverage.run]
source = ["slidge"]

[tool.coverage.report]
exclude_lines = [
    "if .*TYPE_CHECKING:",
    "raise NotImplementedError"
]

[tool.pytest.ini_options]
log_level = "DEBUG"
asyncio_mode = "strict"
filterwarnings = [
    "ignore:The object should be created within an async function:DeprecationWarning:aiohttp",
    "ignore:.*pkg_resources.*:DeprecationWarning",
    "ignore::UserWarning:slidge",
    "ignore:coroutine 'XMLStream._end_stream_wait' was never awaited.*:RuntimeWarning"
]

[[tool.uv.index]]
name = "codeberg"
url = "https://codeberg.org/api/packages/slidge/pypi/simple"
publish-url = "https://codeberg.org/api/packages/slidge/pypi"

[tool.setuptools]
# FIXME: remove this when the setuptools upstream bug is fixed
# https://github.com/astral-sh/uv/issues/9513#issuecomment-2519527822
license-files = []
