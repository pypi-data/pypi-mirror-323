{"version":3,"file":"main.DashboardItems_SiteContext.8aa56a0f85e984047224.js","mappings":"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","sources":["webpack://lino_react/./lino_react/react/components/DashboardItems.jsx"],"sourcesContent":["export const name = \"DashboardItems\";\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { RegisterImportPool, Component } from \"./Base\";\n\nlet ex; const exModulePromises = ex = {\n    lm: import(/* webpackChunkName: \"LoadingMask_DashboardItems\" */\"./LoadingMask\"),\n    prButton: import(/* webpackChunkName: \"prButton_DashboardItems\" */\"primereact/button\"),\n    queryString: import(/* webpackChunkName: \"queryString_DashboardItems\" */\"query-string\"),\n};RegisterImportPool(ex);\n\n\nclass DashboardItem extends Component {\n    static requiredModules = ['lm', 'queryString', 'prButton'];\n    static iPool = ex;\n\n    static propTypes = {\n        itemIndex: (props, ...args) => {\n            if (!props.dashboardMain) return PropTypes.number.isRequired(props, ...args);\n        },\n        dashboardMain: PropTypes.bool.isRequired,\n        APP: PropTypes.object.isRequired\n    }\n    static defaultProps = {\n        dashboardMain: false\n    }\n    async prepare() {\n        super.prepare();\n        this.ex.queryString = this.ex.queryString.default;\n    }\n    constructor(props) {\n        super(props);\n        this.state = {...this.state, data: null, mask: true}\n        this.reload = this.reloadData;\n    }\n\n    onReady() {\n        this.reloadData();\n    }\n\n    /**\n    * @param {bool} selfInit self-initiated reload through the refresh button\n    */\n    reloadData = (selfInit) => {\n        this.setState({mask: true});\n        const query = {fmt: 'json'}, { APP } = this.props,\n            { actionHandler } = APP.URLContext;\n        actionHandler.defaultParams(query);\n        const path = this.props.dashboardMain ? 'api/main_html' : `dashboard/${this.props.itemIndex}`;\n        actionHandler.silentFetch({\n            path: `${path}?${this.ex.queryString.stringify(query)}`,\n            signal: actionHandler.abortController.signal\n        }).then((data) => {\n            if (data.version_mismatch && (this.props.itemIndex === 0 || selfInit)) {\n                APP.reload();\n                return;\n            }\n            this.setState({data: data.html, mask: false});\n        })\n    }\n\n    render() {\n        if (!this.state.ready) return null;\n        const {data} = this.state;\n        if (!this.props.APP.URLContext.filled(data)) return null;\n        return <this.ex.lm.LoadingMask mask={this.state.mask}>\n            {!this.props.dashboardMain && <this.ex.prButton.Button\n                icon=\"pi pi-refresh\" style={{float: 'right'}}\n                onClick={(e) => {\n                    this.reloadData(true);\n                }}/>}\n            <div dangerouslySetInnerHTML={{__html: data}}/>\n        </this.ex.lm.LoadingMask>\n    }\n}\n\n\nexport class DashboardItems extends Component {\n    static propTypes = {\n        APP: PropTypes.object.isRequired\n    };\n    constructor(props) {\n        super(props);\n        this.state = {\n            ...this.state,\n            items: Array((props.APP.state.user_settings.dashboard_items || 0) + 1)\n        };\n        this.reloadData = this.reload;\n    }\n\n    reload() {\n        this.props.APP.URLContext.actionHandler.clearRequestPool();\n        this.state.items.forEach((item, i) => {\n            item.reload()\n        });\n    }\n\n    render() {\n        if (!this.state.ready) return null;\n        return <div>\n            {[...this.state.items.keys()].map(i =>\n                <DashboardItem\n                    dashboardMain={i === 0} itemIndex={i - 1} APP={this.props.APP}\n                    key={i} ref={ref => this.state.items[i] = ref}/>\n            )}\n        </div>\n    }\n}\n"],"names":["name","ex","lm","prButton","queryString","RegisterImportPool","DashboardItem","Component","prepare","super","this","default","constructor","props","_initialiseProps","call","state","data","mask","reload","reloadData","onReady","render","ready","APP","URLContext","filled","_jsxs","LoadingMask","children","dashboardMain","_jsx","Button","icon","style","float","onClick","e","dangerouslySetInnerHTML","__html","requiredModules","iPool","propTypes","itemIndex","args","PropTypes","isRequired","defaultProps","selfInit","setState","query","fmt","actionHandler","defaultParams","path","silentFetch","stringify","signal","abortController","then","version_mismatch","html","DashboardItems","items","Array","user_settings","dashboard_items","clearRequestPool","forEach","item","i","keys","map","ref"],"sourceRoot":""}