# defaults for the gap handler management
[gap_handler]
njobs = 8
min_gap = 128
max_gap = 14400
output_dir = ${home}/omicron/gaps

[condor]
universe = vanilla
accounting_group = ligo.prod.o4.detchar.transient.omicron
accounting_group_user = joseph.areeda
periodic_remove = (JobStatus == 4 && CurrentTime-EnteredCurrentStatus > 7200) || (RequestMemory > 7000 && JobStatus == 1)
getenv = DEFAULT_SEGMENT_SERVER ECP_IDP GWDATAFIND_SERVER HDF5_USE_FILE_LOCKING HOME KRB5CCNAME NDSSERVER
         OMICRON_HTML KRB5_KTNAME X509_USER_PROXY CONDA_PREFIX IFO
periodic_release = (JobStatus == 5) && (CurrentTime-EnteredCurrentStatus > 900) && ((HoldReasonCode =?= 26)
                    || (HoldReasonCode =?= 7))
request_disk = 500M
notification = never
max_concurrent = 64
condor_retry = 2

[find_fill]
universe = vanilla
initial_memory = 2048

[certificates]
scitoken = ${home}/active_certificates/bearer_token
kerberos = ${home}/active_certificates/krbcc_robot
x509 = ${home}/active_certificates/x509.pem

[conda]
environment = ligo-omicron-3.10
executable = /cvmfs/software.igwn.org/conda/condabin/conda

[condor_job_common]
# submit file values shared by all jobs
accounting_group = ligo.prod.o4.detchar.transient.omicron
accounting_group_user_if_shared = joseph.areeda
shared_accounts = detchar, detchar.dev
getenv = X509_USER_PROXY, KRB5CNAME
notification = never

[omicron]
# options for the omicron jobs in a DAG
initial_memory = 4096
max_memory = 10000
allowed_job_duration = 10800
# we're done if we're idle and need more than max memory or held (46) because we passed  max job duration
periodic_remove = (JobStatus == 1 && MemoryUsage >= 10000 || (HoldReasonCode =?= 46 ))
request_memory = ifthenelse(isUndefined(MemoryUsage), 4000, int(3*MemoryUsage))
periodic_release = (HoldReasonCode =?= 26 || HoldReasonCode =?= 34)  && (JobStatus == 5) && (time() - EnteredCurrentStatus > 10)

[post_process]
initial_memory = 2048

[clean]
initial_memory = 2048

[archive]
initial_memory = 2048

# options for the omicron process itself vs the condor job to run it
[process]
# how old to switch from guardian channel to dqsegdb
max_guardian = 600
# how far back for an online job
max_lookback = 5400
max_chunks_per_job = 4
# divide each group into sets of this many channels
max_channels_per_job = 10
condor_request_disk = 20G